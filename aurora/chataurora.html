import '/backend/api_requests/api_calls.dart';
import '/flutter_flow/flutter_flow_icon_button.dart';
import '/flutter_flow/flutter_flow_theme.dart';
import '/flutter_flow/flutter_flow_util.dart';
import '/flutter_flow/flutter_flow_widgets.dart';
import 'package:flutter/material.dart';
import 'package:flutter_spinkit/flutter_spinkit.dart';
import 'package:google_fonts/google_fonts.dart';
import 'package:provider/provider.dart';

import 'chataurora_model.dart';
export 'chataurora_model.dart';

class ChatauroraWidget extends StatefulWidget {
const ChatauroraWidget({super.key});

@override
State<ChatauroraWidget> createState() => _ChatauroraWidgetState();
  }

  class _ChatauroraWidgetState extends State<ChatauroraWidget> {
    late ChatauroraModel _model;

    final scaffoldKey = GlobalKey<ScaffoldState>();

      @override
      void initState() {
      super.initState();
      _model = createModel(context, () => ChatauroraModel());

      _model.textController ??= TextEditingController();
      _model.textFieldFocusNode ??= FocusNode();

      WidgetsBinding.instance.addPostFrameCallback((_) => safeSetState(() {}));
      }

      @override
      void dispose() {
      _model.dispose();

      super.dispose();
      }

      @override
      Widget build(BuildContext context) {
      return GestureDetector(
      onTap: () => FocusScope.of(context).unfocus(),
      child: Scaffold(
      key: scaffoldKey,
      backgroundColor: FlutterFlowTheme.of(context).secondaryBackground,
      body: Column(
      mainAxisSize: MainAxisSize.min,
      children: [
      AnimatedContainer(
      duration: Duration(milliseconds: 100),
      curve: Curves.easeIn,
      width: MediaQuery.sizeOf(context).width,
      height: MediaQuery.sizeOf(context).height * 1,
      decoration: BoxDecoration(
      gradient: LinearGradient(
      colors: [Color(0xFF4B39EF), Color(0xFF3F51B5)],
      stops: [0, 1],
      begin: AlignmentDirectional(0, -1),
      end: AlignmentDirectional(0, 1),
      ),
      ),
      child: Padding(
      padding: EdgeInsetsDirectional.fromSTEB(24, 24, 24, 24),
      child: Column(
      mainAxisSize: MainAxisSize.min,
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
      Row(
      mainAxisSize: MainAxisSize.max,
      mainAxisAlignment: MainAxisAlignment.spaceBetween,
      children: [
      FlutterFlowIconButton(
      borderRadius: 20,
      buttonSize: 40,
      fillColor: Color(0x33FFFFFF),
      icon: Icon(
      Icons.arrow_back,
      color: Colors.white,
      size: 24,
      ),
      onPressed: () async {
      context.goNamed(
      'menu',
      extra: <String, dynamic>{
        kTransitionInfoKey: TransitionInfo(
        hasTransition: true,
        transitionType:
        PageTransitionType.leftToRight,
        duration: Duration(milliseconds: 500),
        ),
        },
        );
        },
        ),
        FlutterFlowIconButton(
        borderRadius: 20,
        buttonSize: 40,
        fillColor: Color(0x33FFFFFF),
        icon: Icon(
        Icons.more_vert,
        color: Colors.white,
        size: 24,
        ),
        onPressed: () {
        print('IconButton pressed ...');
        },
        ),
        ],
        ),
        Row(
        mainAxisSize: MainAxisSize.max,
        children: [
        Material(
        color: Colors.transparent,
        elevation: 4,
        shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(30),
        ),
        child: Container(
        width: 60,
        height: 60,
        decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(30),
        ),
        child: ClipRRect(
        borderRadius: BorderRadius.circular(30),
        child: Image.asset(
        'assets/images/_20ffd65f-8410-4104-a706-15f0c9d6a0ea.jpeg',
        width: 60,
        height: 60,
        fit: BoxFit.cover,
        ),
        ),
        ),
        ),
        Column(
        mainAxisSize: MainAxisSize.min,
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
        Text(
        'Aurora',
        style: FlutterFlowTheme.of(context)
        .titleMedium
        .override(
        fontFamily: 'Readex Pro',
        color: Colors.white,
        letterSpacing: 0.0,
        fontWeight: FontWeight.w600,
        ),
        ),
        Text(
        'Assistente Virtual',
        style: FlutterFlowTheme.of(context)
        .bodyMedium
        .override(
        fontFamily: 'Inter',
        color: Color(0xFFE0E0E0),
        letterSpacing: 0.0,
        ),
        ),
        ],
        ),
        ].divide(SizedBox(width: 16)),
        ),
        Material(
        color: Colors.transparent,
        elevation: 8,
        shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(24),
        ),
        child: Container(
        width: MediaQuery.sizeOf(context).width,
        height: 80,
        decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(24),
        ),
        child: Padding(
        padding: EdgeInsetsDirectional.fromSTEB(16, 0, 16, 0),
        child: Row(
        mainAxisSize: MainAxisSize.max,
        children: [
        Expanded(
        child: Container(
        width: MediaQuery.sizeOf(context).height,
        child: TextFormField(
        controller: _model.textController,
        focusNode: _model.textFieldFocusNode,
        onFieldSubmitted: (_) async {
        await _model.columnController?.animateTo(
        _model.columnController!.position
        .maxScrollExtent,
        duration: Duration(milliseconds: 100),
        curve: Curves.ease,
        );
        },
        autofocus: false,
        obscureText: false,
        decoration: InputDecoration(
        isDense: true,
        labelStyle: FlutterFlowTheme.of(context)
        .bodyLarge
        .override(
        fontFamily: 'Inter',
        color: Colors.black,
        letterSpacing: 0.0,
        ),
        hintText: 'Digite seu texto...',
        hintStyle: FlutterFlowTheme.of(context)
        .bodyMedium
        .override(
        fontFamily: 'Inter',
        color: Colors.black,
        letterSpacing: 0.0,
        ),
        enabledBorder: InputBorder.none,
        focusedBorder: InputBorder.none,
        errorBorder: InputBorder.none,
        focusedErrorBorder: InputBorder.none,
        filled: true,
        fillColor: Colors.white,
        hoverColor: Colors.white,
        ),
        style: FlutterFlowTheme.of(context)
        .bodyMedium
        .override(
        fontFamily: 'Inter',
        color: Colors.black,
        letterSpacing: 0.0,
        ),
        textAlign: TextAlign.justify,
        maxLines: 3,
        minLines: 1,
        validator: _model.textControllerValidator
        .asValidator(context),
        ),
        ),
        ),
        FlutterFlowIconButton(
        borderRadius: 100,
        buttonSize: 48,
        fillColor: FlutterFlowTheme.of(context).primary,
        icon: Icon(
        Icons.send,
        color: Colors.white,
        size: 18,
        ),
        showLoadingIndicator: true,
        onPressed: () async {
        if (_model.textController.text != null &&
        _model.textController.text != '') {
        _model.respostadaaurora =
        await ApiauroraCall.call(
        meuprompt: _model.textController.text,
        );
        }

        safeSetState(() {});
        },
        ),
        ].divide(SizedBox(width: 16)),
        ),
        ),
        ),
        ),
        Expanded(
        child: Container(
        width: MediaQuery.sizeOf(context).width,
        decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(24),
        ),
        child: Padding(
        padding:
        EdgeInsetsDirectional.fromSTEB(24, 24, 24, 24),
        child: SingleChildScrollView(
        controller: _model.columnController,
        child: Column(
        mainAxisSize: MainAxisSize.min,
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
        Container(
        width: MediaQuery.sizeOf(context).width * 0.8,
        decoration: BoxDecoration(
        color: Color(0xFFCBCDD0),
        borderRadius: BorderRadius.circular(16),
        ),
        alignment: AlignmentDirectional(-1, 1),
        child: Padding(
        padding: EdgeInsetsDirectional.fromSTEB(
        16, 16, 16, 16),
        child: Column(
        mainAxisSize: MainAxisSize.min,
        crossAxisAlignment:
        CrossAxisAlignment.start,
        children: [
        Text(
        valueOrDefault<String>(
          ApiauroraCall.textogerado(
          (_model.respostadaaurora
          ?.jsonBody ??
          ''),
          ),
          'Oi, como posso ajudar vc?',
          ),
          style: FlutterFlowTheme.of(context)
          .bodyMedium
          .override(
          fontFamily: 'Inter',
          color: Colors.black,
          letterSpacing: 0.0,
          ),
          ),
          ],
          ),
          ),
          ),
          ].divide(SizedBox(height: 16)),
          ),
          ),
          ),
          ),
          ),
          ].divide(SizedBox(height: 24)),
          ),
          ),
          ),
          ],
          ),
          ),
          );
          }
          }